containers:
  exonum:
    environ:
      NIGHTLY_RUST: "nightly-2017-07-05"
      CLIPPY_VERS: "0.0.142"
      RUSTFMT_VERS: "0.9.0"
      SODIUM_VERS: "1.0.13"
      CARGO_INCREMENTAL: "1"
      RUSTFLAGS: "-C link-dead-code"
      RUST_VERSION: "stable"
    setup:
    - !Ubuntu trusty
    - !Install [gcc, g++, make, libleveldb-dev, libssl-dev]
    - !TarInstall
      url: "https://github.com/jedisct1/libsodium/releases/download/1.0.13/libsodium-1.0.13.tar.gz"
      script: |
        ./configure --prefix=$HOME/.local
        make
        make install
        cd ..

    - !TarInstall
      url: "https://static.rust-lang.org/dist/rust-1.19.0-x86_64-unknown-linux-gnu.tar.gz"
      script: "./install.sh --prefix=/usr --components=rustc,rust-std-x86_64-unknown-linux-gnu,cargo"

commands:

  build: !Command
    description: Build exonum
    container: exonum
    run: cargo build -p exonum
